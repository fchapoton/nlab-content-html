
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0 plus SVG 1.1//EN" "http://www.w3.org/2002/04/xhtml-math-svg/xhtml-math-svg-flat.dtd" >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>
      continuation-passing style in nLab
  </title>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="robots" content="index,follow" />


  <link href="/stylesheets/instiki.css?1534097725" media="all" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/mathematics.css?1534319116" media="all" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/syntax.css?1531905161" media="all" rel="stylesheet" type="text/css" />
  <style type="text/css">
    h1#pageName, div.info, .newWikiWord a, a.existingWikiWord, .newWikiWord a:hover, [actiontype="toggle"]:hover, #TextileHelp h3 {
      color: #008B26;
    }
    a:visited.existingWikiWord {
      color: #005c19;
    }
    
    
  </style>
  
  <style type="text/css"><!--/*--><![CDATA[/*><!--*/
    .toc ul {margin: 0; padding: 0;}
.toc ul ul {margin: 0; padding: 0 0 0 10px;}
.toc li > p {margin: 0}
.toc ul li {list-style-type: none; position: relative;}
.toc div {border-top:1px dotted #ccc;}
.rightHandSide h2 {font-size: 1.5em;color:#008B26}
table.plaintable {
    border-collapse:collapse;
    margin-left:30px;
    border:0;
}
.plaintable td {border:1px solid #000; padding: 3px;}
.plaintable th {padding: 3px;}
.plaintable caption {
    font-weight: bold;
    font-size:1.1em;
    text-align:center;
    margin-left:30px;
}
    
   
/* Query boxes for questioning and answering mechanism */
div.query{
background: #f6fff3;
border: solid #ce9;
border-width: 2px 1px;
padding: 0 1em;
margin: 0 1em;
max-height: 20em;
overflow: auto;
}

/* Standout boxes for putting important text */
div.standout{
background: #fff1f1;
border: solid black;
border-width: 2px 1px;
padding: 0 1em;
margin: 0 1em;
overflow: auto;
}

/* Icon for links to n-category arXiv documents 
 (commented out for now i.e. disabled)
a[href*="http://arxiv.org/"] {
  background-image: url(../files/arXiv_icon.gif);
  background-repeat: no-repeat;
  background-position: right bottom;
     padding-right: 22px;
  } */
    
/* Icon for links to n-category cafe posts (disabled) 
a[href*="http://golem.ph.utexas.edu/category"] {
  background-image: url(../files/n-cafe_5.gif);
  background-repeat: no-repeat;
  background-position: right bottom;
     padding-right: 25px;
  } */

/* Icon for links to pdf files (disabled)
a[href$=".pdf"] {
  background-image: url(../files/pdficon_small.gif);
  background-repeat: no-repeat;
  background-position: right bottom;
     padding-right: 25px;
  } */

/* Icon for links to pages, etc. -inside- pdf files (disabled)
a[href*=".pdf#"] {
  background-image: url(../files/pdf_entry.gif);
  background-repeat: no-repeat;
  background-position: right bottom;
     padding-right: 25px;
  } */

a.existingWikiWord {
color: #005000;
}

a.existingWikiWord:visited {
color: #005000;
}


a.existingWikiWord[title] {
border: 0px;
color: #aa0505;
text-decoration: none;
}
    
a.existingWikiWord[title]:visited {
border: 0px;
color: #551111;
text-decoration: none;
}

a[href^="http://"] {
border: 0px;
color: #003399;
}

a[href^="http://"]:visited {
border: 0px;
color: #330066;
}

a[href^="https://"] {
border: 0px;
color: #003399;
}

a[href^="https://"]:visited {
border: 0px;
color: #330066;
}

div.dropDown .hide {
display: none;
}

div.dropDown:hover .hide {
display:block;
}

div.clickDown .hide {
display: none;
}

div.clickDown:focus {
outline:none;
}

div.clickDown:focus .hide, div.clickDown:hover .hide {
display: block;
}

div.clickDown .clickToReveal, div.clickDown:focus .clickToHide {
display:block;
}

div.clickDown:focus .clickToReveal, div.clickDown .clickToHide {
display:none;
}

div.clickDown .clickToReveal:after {
content: "\A(Hover to reveal, click to \"hold\")";
font-size: 60%;
}

div.clickDown .clickToHide:after {
content: "\A(Click to hide)";
font-size: 60%;
}
div.clickDown .clickToHide, div.clickDown .clickToReveal {
white-space: pre-wrap;
}

.un_theorem, .num_theorem, .un_lemma, .num_lemma, .un_prop, .num_prop, .un_cor, .num_cor, .un_defn, .num_defn, .un_example, .num_example, .un_note, .num_note, .un_remark, .num_remark {
margin-left: 1em;
}

span.theorem_label {
margin-left: -1em;
}
.proof span.theorem_label {
margin-left: 0em;
}
:target {
    background-color: #BBBBBB;
    border-radius: 5pt;
    padding: 0 10pt;
}
    
    
    
    
    
    
    
    
    
    
    
  /*]]>*/--></style>
  <script src="/javascripts/prototype.js?1532905251" type="text/javascript"></script>
<script src="/javascripts/effects.js?1532905251" type="text/javascript"></script>
<script src="/javascripts/dragdrop.js?1532905252" type="text/javascript"></script>
<script src="/javascripts/controls.js?1532905250" type="text/javascript"></script>
<script src="/javascripts/application.js?1532905250" type="text/javascript"></script>
  <script src="/javascripts/page_helper.js?1533109147" type="text/javascript"></script>
  <script src="/javascripts/thm_numbering.js?1533108238" type="text/javascript"></script>
  
  <script type="text/x-mathjax-config">
  <!--//--><![CDATA[//><!--
    MathJax.Ajax.config.path["Contrib"] = "/MathJax";
    MathJax.Hub.Config({
      MathML: { useMathMLspacing: true },
      "HTML-CSS": { scale: 90,
                    extensions: ["handle-floats.js"]
      }
    });
    MathJax.Hub.Queue( function () {
       var fos = document.getElementsByTagName('foreignObject');
       for (var i = 0; i < fos.length; i++) {
         MathJax.Hub.Typeset(fos[i]);
       }
    });
  //--><!]]>
  </script>

  <script type="text/javascript">
    <!--//--><![CDATA[//><!--
    window.addEventListener("DOMContentLoaded", function () {
      var div = document.createElement('div');
      var math = document.createElementNS('http://www.w3.org/1998/Math/MathML', 'math');
      document.body.appendChild(div);
      div.appendChild(math);
    // Test for MathML support comparable to WebKit version https://trac.webkit.org/changeset/203640 or higher.
      div.setAttribute('style', 'font-style: italic');
      var mathml_unsupported = !(window.getComputedStyle(div.firstChild).getPropertyValue('font-style') === 'normal');
      div.parentNode.removeChild(div);
      if (mathml_unsupported) {
        // MathML does not seem to be supported...
        var s = document.createElement('script');
        s.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=MML_HTMLorMML-full";
        document.querySelector('head').appendChild(s);
      } else {
        document.head.insertAdjacentHTML("beforeend", '<style>svg[viewBox] {max-width: 100%}</style>');
      }
    });
    //--><!]]>
  </script>

  	<link href="https://ncatlab.org/nlab/atom_with_headlines" rel="alternate" title="Atom with headlines" type="application/atom+xml" />
  	<link href="https://ncatlab.org/nlab/atom_with_content" rel="alternate" title="Atom with full content" type="application/atom+xml" />
  <script type="text/javascript">
  document.observe("dom:loaded", function() {
    generateThmNumbers();
  });
  </script>
</head>

<body>

<div id="Container">
<div id="Content">
  <h1 id="pageName">
    
<span id="svg_logo"><svg version="1.1" width="100%" height="100%" viewBox='0 -1 180 198' xmlns='http://www.w3.org/2000/svg'>
      <path id="svg_logo_path" fill="#008B26" stroke-width='0.5' stroke='#000' d='
        M170,60c4,11-1,20-12,25c-9,4-25,3-20,15c5,5,15,0,24,1c11,1,21,11,14,21c-10,15-35,6-48-1c-5-3-27-23-32-10c-1,13,15,10,22,16
        c11,4,24,14,34,20c12,10,7,25-9,23c-11-1-22-9-30-16c-5-5-13-18-21-9c-2,6,2,11,5,14c9,9,22,14,22,31c-2,8-12,8-18,4c-4-3-9-8-11-13
        c-3-6-5-18-12-18c-14-1-5,28-18,30c-9,2-13-9-12-16c1-14,12-24,21-31c5-4,17-13,10-20c-9-10-19,12-23,16c-7,7-17,16-31,15
        c-9-1-18-9-11-17c5-7,14-4,23-6c6-1,15-8,8-15c-5-6-57,2-42-24c7-12,51,4,61,6c6,1,17,4,18-4c2-11-12-7-21-8c-21-2-49-14-49-34
        c0-5,3-11,8-11C31,42,34,65,42,67c6,1,9-3,8-9C49,49,38,40,40,25c1-5,4-15,13-14c10,2,11,18,13,29c1,8,0,24,7,28c15,0,5-22,4-30
        C74,23,78,7,87,1c8-4,14,1,16,9c2,11-8,21-2,30c8,2,11-6,14-12c9-14,36-18,30,5c-3,9-12,19-21,24c-6,4-22,10-23,19c-2,14,15,2,18-2
        c9-9,20-18,33-22C159,52,166,54,170,60' />
    </svg></span>
      <span class="webName">nLab</span><br />
      continuation-passing style
  </h1>



<div class="navigation">
    <span class="skipNav"><a href='#navEnd'>Skip the Navigation Links</a> | </span>
    <a href="/nlab/show/HomePage" accesskey="H" title="Home page">Home Page</a> |
    <a href="/nlab/all_pages" accesskey="A" title="List of all pages">All Pages</a> |
    <a href="/nlab/latest_revisions" accesskey="U" title="Latest edits and page creations">Latest Revisions</a> |
    <a href="https://nforum.ncatlab.org/discussion/7124/#Item_3" title="Discuss this page in its dedicated thread on the nForum" style="color: black">Discuss this page</a> |
    <a href="/nlab/feeds" title="Subscribe to changes by Atom">Feeds</a> |
<form accept-charset="utf-8" action="/nlab/search" id="navigationSearchForm" method="get">      <fieldset class="search"><input type="text" id="searchField" name="query" value="Search"
             onfocus="this.value == 'Search' ? this.value = '' : true"
             onblur="this.value == '' ? this.value = 'Search' : true" /></fieldset>
</form>  <span id='navEnd'></span>
</div>






<div id="revision">
    <html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg" xml:lang="en" lang="en">
<head><meta http-equiv="Content-type" content="application/xhtml+xml;charset=utf-8" /><title>Contents</title></head>
<body>
<h1 id="contents">Contents</h1>
<div class='maruku_toc'>
<ul>
<li><a href='#idea'>Idea</a></li>
<li><a href='#continuation_semantics'>Continuation semantics</a></li>
<li><a href='#related_concepts'>Related concepts</a></li>
<li><a href='#references'>References</a></li>
</ul>
</div>

<h2 id="idea">Idea</h2>

<p>In the theory of <a class="existingWikiWord" href="/nlab/show/programming+languages">programming languages</a>, the idea that procedures may be modelled as mathematical <a class="existingWikiWord" href="/nlab/show/functions">functions</a> is useful for compositional reasoning, but at first seems to rule out programming with more sophisticated control structures which can actually be very useful in practice. For example, we might want to write an integer division routine which raises an exception on division-by-zero, or a procedure that lazily computes the first satisfying assignment to a boolean formula while giving the user the ability to query to obtain additional ones.</p>

<p>Now, an “impure” functional language such as OCaml lets us do some of this directly. For example, we can write the following code for integer division:</p>

<pre><code>let divide : int -&gt; int -&gt; int =
  fun x y -&gt; if y == 0 then raise Division_by_zero else x / y</code></pre>

<p>However, it should be said that the type ascription “<code>int -&gt; int -&gt; int</code>” is a bit misleading here (or at least open to misinterpretation), since <code>divide</code> cannot actually be modelled as a set-theoretic function of type <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline" class="maruku-mathml"><semantics><mrow><mi>ℤ</mi><mo>→</mo><mi>ℤ</mi><mo>→</mo><mi>ℤ</mi></mrow><annotation encoding="application/x-tex">\mathbb{Z} \to \mathbb{Z} \to \mathbb{Z}</annotation></semantics></math>.</p>

<p><em>Continuation-passing style</em> (or CPS) is a very general technique that allows one to express many different seemingly “non-functional” patterns of control flow within the confines of pure functional programming. The basic idea is that a procedure in CPS takes an additional argument (often named “<math xmlns="http://www.w3.org/1998/Math/MathML" display="inline" class="maruku-mathml"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math>”) representing the <em>continuation</em>, a functional abstraction of the context in which the procedure is used (or “the rest of the computation”). Whenever a procedure in “direct style” would return a value (<math xmlns="http://www.w3.org/1998/Math/MathML" display="inline" class="maruku-mathml"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math>), the corresponding procedure in CPS instead invokes the continuation with that value (<math xmlns="http://www.w3.org/1998/Math/MathML" display="inline" class="maruku-mathml"><semantics><mrow><mi>k</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">k(v)</annotation></semantics></math>). However, it is the fact that the procedure has explicit access to the continuation which also allows for the possibility of exceptional behaviors, typically by throwing away the continuation or by invoking it more than once.</p>

<p>To transform the example above into continuation-passing style, first we must fix an “answer type”, that is, the return type of the continuation. In this case, to allow for the possibility of raising a division-by-zero error, the answer type should be a <a class="existingWikiWord" href="/nlab/show/pointed+type">pointed type</a>. For example, we could take</p>

<pre><code>type ans = int option</code></pre>

<p>Now, our division routine can be written as follows in CPS:</p>

<pre><code>let divide_cps : int -&gt; int -&gt; (int -&gt; ans) -&gt; ans =
  fun x y k -&gt; if y == 0 then None else k (x / y)</code></pre>

<p>Observe that we have replaced the (somewhat misleading) original type</p>

<pre><code>divide : int -&gt; int -&gt; int</code></pre>

<p>by the more complicated type</p>

<pre><code>divide_cps : int -&gt; int -&gt; (int -&gt; ans) -&gt; ans</code></pre>

<p>This may be recognized as a form of <a class="existingWikiWord" href="/nlab/show/double+negation+translation">double negation translation</a>, and indeed under <a class="existingWikiWord" href="/nlab/show/propositions+as+types">propositions as types</a>, the classical negative translations correspond to different forms of continuation-passing style transformations. Under this correspondence, the “answer type” corresponds to the type of <a class="existingWikiWord" href="/nlab/show/false">absurdity</a> <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline" class="maruku-mathml"><semantics><mrow><mo>⊥</mo></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math>, but as the above example shows, we almost never want the answer type to be <a class="existingWikiWord" href="/nlab/show/empty+type">empty</a>. As such, CPS translation is best understood in terms of the negative translations from <a class="existingWikiWord" href="/nlab/show/classical+logic">classical logic</a> into <a class="existingWikiWord" href="/nlab/show/minimal+logic">minimal logic</a>, where the type of falsehood <math xmlns="http://www.w3.org/1998/Math/MathML" display="inline" class="maruku-mathml"><semantics><mrow><mo>⊥</mo></mrow><annotation encoding="application/x-tex">\bot</annotation></semantics></math> behaves like a fixed atomic proposition.</p>

<h2 id="continuation_semantics">Continuation semantics</h2>

<p>Whereas “continuation-passing style” refers to a programming technique, the term “continuation semantics” refers to a certain way of assigning <a class="existingWikiWord" href="/nlab/show/denotational+semantics">denotational semantics</a> to programs, originally in the context of <a class="existingWikiWord" href="/nlab/show/domain+theory">domain theory</a> <a href="#StracheyWadsworth74">(Strachey &amp; Wadsworth 1974)</a>. The two are very closely related, though, especially if one views the meaning function ⟦-⟧ in a denotational semantics as a “definitional interpreter” in the sense of <a href="#Reynolds72">(Reynolds 1972)</a>. In that case, giving a continuation semantics for a language corresponds to writing the definitional interpreter in continuation-passing style.</p>

<h2 id="related_concepts">Related concepts</h2>

<ul>
<li>
<p><a class="existingWikiWord" href="/nlab/show/continuation+monad">continuation monad</a></p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/programming+language">programming language</a></p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/functional+programming">functional programming</a></p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/Yoneda+lemma">Yoneda lemma</a></p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/negative+translation">negative translation</a></p>
</li>

<li>
<p><a href="excluded+middle#DoubleNegatedPEM">double-negated principle of excluded middle</a></p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/monad+%28in+computer+science%29">monad (in computer science)</a></p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/defunctionalization">defunctionalization</a>, often used in conjunction with continuation-passing style</p>
</li>
</ul>

<h2 id="references">References</h2>

<p>Some early and historical references for continuations and continuation-passing style include:</p>

<ul>
<li id="Reynolds72">
<p><a class="existingWikiWord" href="/nlab/show/John+C.+Reynolds">John C. Reynolds</a>. Definitional interpreters for higher-order programming languages. In <em>Proceedings of the ACM National Conference</em>, 1972. (<a href="http://surface.syr.edu/cgi/viewcontent.cgi?article=1012&amp;context=lcsmith_other">pdf</a>)</p>
</li>

<li id="StracheyWadsworth74">
<p>Christopher Strachey and C. P. Wadsworth. Continuations: A Mathematical Semantics for Handling Full Jumps, Technical Monograph PRG-11, Oxford, 1974. (<a href="http://repository.readscheme.org/ftp/papers/plsemantics/oxford/strachey-continuations.PDF">pdf</a>)</p>
</li>

<li id="Reynolds74">
<p><a class="existingWikiWord" href="/nlab/show/John+C.+Reynolds">John C. Reynolds</a>. On the Relation Between Direct and Continuation Semantics. Second Colloquium on Automata, Languages, and Programming, Saarbrucken, July 29 - August 2, 1974. (<a href="http://repository.cmu.edu/cgi/viewcontent.cgi?article=2287&amp;context=compsci">pdf</a>)</p>
</li>

<li id="Plotkin75">
<p><a class="existingWikiWord" href="/nlab/show/Gordon+Plotkin">Gordon Plotkin</a>. Call-by-name, call-by-value, and the lambda-calculus. <em>Theoretical Computer Science</em> 1 (1975), 125-159. (<a href="http://homepages.inf.ed.ac.uk/gdp/publications/cbn_cbv_lambda.pdf">pdf</a>)</p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/John+C.+Reynolds">John C. Reynolds</a>. The Discoveries of Continuations. <em>LISP and Symbolic Computation</em> 6 (1993), 233-247. (<a href="http://www.math.bas.bg/bantchev/place/iswim/conti-disco.pdf">pdf</a>)</p>
</li>
</ul>

<p>Other references include:</p>

<ul>
<li>
<p><a class="existingWikiWord" href="/nlab/show/Hayo+Thielecke">Hayo Thielecke</a>. <em>Categorical Structure of Continuation Passing Style</em>. PhD thesis, University of Edinburgh, 1997. (<a href="http://www.lfcs.inf.ed.ac.uk/reports/97/ECS-LFCS-97-376/ECS-LFCS-97-376.pdf">pdf</a>)</p>
</li>

<li>
<p><span class="newWikiWord">Josh Berdine<a href="/nlab/new/Josh+Berdine">?</a></span>, <a class="existingWikiWord" href="/nlab/show/Peter+O%27Hearn">Peter O'Hearn</a>, <a class="existingWikiWord" href="/nlab/show/Uday+Reddy">Uday Reddy</a>, <a class="existingWikiWord" href="/nlab/show/Hayo+Thielecke">Hayo Thielecke</a>. Linear Continuation-Passing. <em>Higher-Order and Symbolic Computation</em> 15 (2002), 181-208. (<a href="http://research.microsoft.com/pubs/64171/LinCP.pdf">pdf</a>)</p>
</li>

<li>
<p><a class="existingWikiWord" href="/nlab/show/Ulrich+Sch%C3%B6pp">Ulrich Schöpp</a>. On the Relation of Interaction Semantics to Continuations and Defunctionalization. <em>Logical Methods in Computer Science</em> Vol.10(4:10)2014, 1-41. (<a href="http://arxiv.org/pdf/1410.4980.pdf">pdf</a>)</p>
</li>

<li>
<p>Wikipedia, <em><a href="http://en.wikipedia.org/wiki/Continuation-passing_style">Continuation-passing style</a></em></p>
</li>
</ul>

<p>For the connection between CPS and the <a class="existingWikiWord" href="/nlab/show/Yoneda+lemma">Yoneda lemma</a>, see</p>

<ul>
<li>
<p>Ralf Hinze, Daniel W. H. James, <em>Reason Isomorphically!</em>, secions 3-4, <a href="http://www.cs.ox.ac.uk/ralf.hinze/publications/WGP10.pdf">pdf</a></p>
</li>

<li>
<p>Mike Stay, <em>The Continuation Passing Transform and the Yoneda Embedding</em>, <a href="https://golem.ph.utexas.edu/category/2008/01/the_continuation_passing_trans.html">blog post</a></p>
</li>
</ul>
</body></html>

</div>

<div class="revisedby">
  <p>
  Last revised on December  2, 2018 at 13:43:48.
  See the <a href="https://ncatlab.org/nlab/history/continuation-passing style" style="color: #005c19">history</a> of this page for a list of all contributions to it.
  </p>
</div>

<div class="navigation navfoot">

  <a href="/nlab/edit/continuation-passing+style" accesskey="E" class="navlink" id="edit" rel="nofollow">Edit</a> | <a href="/nlab/revision/continuation-passing+style/10" accesskey="B" class="navlink" id="to_previous_revision" rel="nofollow">Back in time</a> <span class='revisions'>(10 revisions)</span> | <a href="/nlab/show/diff/continuation-passing+style" accesskey="C" class="navlink" id="see_changes" rel="nofollow">See changes</a> | <a href="/nlab/history/continuation-passing+style" accesskey="S" class="navlink" id="history" rel="nofollow">History</a>
  | <a href="https://ncatlab.org/nlab/show/continuation-passing style/cite" style="color: black">Cite</a>
  <span class="views">
    | Views:
    <a href="/nlab/print/continuation-passing+style" accesskey="p" id="view_print" rel="nofollow">Print</a>
    |
    <a href="/nlab/tex/continuation-passing+style" id="view_tex" rel="nofollow">TeX</a>
    |
    <a href="/nlab/source/continuation-passing+style" id="view_source" rel="nofollow">Source</a>
  </span>

  


</div>


    <div id="footer">
    <div>This site is running on <a href="http://golem.ph.utexas.edu/instiki/show/HomePage">Instiki 0.19.7(MML+)</a></div>
    <div>Powered by <a href="http://rubyonrails.com/">Ruby on Rails</a>  2.3.18</div>
    </div>

</div> <!-- Content -->

</div> <!-- Container -->

</body>
</html>
